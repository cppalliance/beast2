#
# Copyright (c) 2023 Vinnie Falco (vinnie.falco@gmail.com)
#
# Distributed under the Boost Software License, Version 1.0. (See accompanying
# file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
#
# Official repository: https://github.com/cppalliance/beast2
#

import testing ;
import ac ;

using openssl ;

lib advapi32 ;
lib crypt32 ;
lib gdi32 ;
lib user32 ;

project
    : requirements
      $(c11-requires)
      <library>/boost/beast2//boost_beast2/
      <source>../../../url/extra/test_suite/test_main.cpp
      <source>../../../url/extra/test_suite/test_suite.cpp
      <include>.
      <include>../..
      <include>../../../url/extra/test_suite
      <include>../../example/include
      <warnings>extra
      <warnings-as-errors>on
      <undefined-sanitizer>norecover:<link>static
      <toolset>clang-win:<cxxflags>"-Wno-unused-private-field"
    ;

for local f in [ glob-tree-ex . : *.cpp : ssl_*.cpp ]
{
    run $(f) ;
}

for local f in [ glob-tree-ex . : ssl_*.cpp ]
{
    run $(f)
        : requirements
          [ ac.check-library /openssl//ssl : <library>/openssl//ssl/<link>shared : <build>no ]
          [ ac.check-library /openssl//crypto : <library>/openssl//crypto/<link>shared : <build>no ]
          <target-os>windows:<library>advapi32
          <target-os>windows:<library>crypt32
          <target-os>windows:<library>gdi32
          <target-os>windows:<library>user32
        ;
}
